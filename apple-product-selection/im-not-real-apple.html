<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I'm not real Apple</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"
        integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous">
    <style>
        /* 全域設定 */
        .container {
            max-width: 1024px !important;
        }

        /* 處理bootstrap focus */

        .btn:focus,
        /*清除btn按鈕點擊出現的邊框*/
        .btn:active:focus,
        .btn.active:focus,
        .btn.focus,
        .btn:active.focus,
        .btn.active.focus,
        button:focus {
            outline: none !important;
            box-shadow: none !important;
        }

        .form-control:focus {
            /*清除input框focus出現的邊框*/
            border-color: #fff;
            webkit-box-shadow: none;
            box-shadow: none;
        }

        .color-btn {
            border: 1px solid #dee2e6;
            position: relative;
        }

        .color-btn:hover {
            border: 1px solid #000000;
        }

        .color-btn i {
            font-size: 2rem;
        }

        .color-name {
            font-size: .5rem;
        }


        .spec-val {
            font-size: 1.2rem;
        }

        .fit {
            font-size: .5rem;
        }

        [selected="true"]::after {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            border: 2px solid #0071e3;
            border-radius: 0.25rem;
        }

        .accordion-header {
            position: relative;
        }

        button[aria-expanded] {
            opacity: 1;
            transition: .5s;
        }

        button[aria-expanded='true'] {
            opacity: 0;
            display: none;
        }
    </style>
    <!-- Hotjar Tracking Code for https://alanlucasli.github.io/apple-product-selection/im-not-real-apple.html -->
    <script>
        (function (h, o, t, j, a, r) {
            h.hj = h.hj || function () { (h.hj.q = h.hj.q || []).push(arguments) };
            h._hjSettings = { hjid: 3466734, hjsv: 6 };
            a = o.getElementsByTagName('head')[0];
            r = o.createElement('script'); r.async = 1;
            r.src = t + h._hjSettings.hjid + j + h._hjSettings.hjsv;
            a.appendChild(r);
        })(window, document, 'https://static.hotjar.com/c/hotjar-', '.js?sv=');
    </script>
</head>

<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WSW5V2L" height="0" width="0"
            style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div>
        <section class="apple-nav d-flex justify-content-center align-items-center bg-dark">
            <ul class="nav-bar list-unstyled d-flex m-0">
            </ul>
        </section>
        <section class="apple-info container d-flex justify-content-between align-items-center py-2">
            <h3 class="m-0 product-type"></h3>
            <strong class="m-0 price-top"></strong>
        </section>
    </div>
    <section class="container py-3">
        <div class="row">
            <div class="col-12 col-md-6">
                <div class="img-box px-4 py-5">
                    <img class="w-100 product-img" src="" alt="">
                </div>
            </div>
            <div class="col-12 col-md-6">
                <h1>
                    <strong class="product-name"></strong>
                </h1>
                <div class="accordion" id="accordionPanelsStayOpenExample">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                data-bs-target="#panelsStayOpen-color" aria-expanded="true"
                                aria-controls="panelsStayOpen-color">
                                {{外觀}}
                            </button>
                        </h2>
                        <div id="panelsStayOpen-color" class="accordion-collapse collapse show">
                            <div class="accordion-body">
                                <h5><strong>外觀。挑選喜愛的顏色。</strong></h5>
                                <div class="row color-area">
                                    <!-- <div class="col-6 mb-3">
                                        <button class="btn color-btn w-100">
                                            <div class="py-4 d-flex flex-column justify-content-center align-items-center">
                                                <i class="fas fa-circle"></i>
                                                <span class="color-name"></span>
                                            </div>
                                        </button>
                                    </div>
                                    <div class="col-6 mb-3">
                                        <button class="btn color-btn w-100">
                                            <div class="py-4 d-flex flex-column justify-content-center align-items-center">
                                                <i class="fas fa-circle"></i>
                                                <span class="color-name"></span>
                                            </div>
                                        </button>
                                    </div>
                                    <div class="col-6 mb-3">
                                        <button class="btn color-btn w-100">
                                            <div class="py-4 d-flex flex-column justify-content-center align-items-center">
                                                <i class="fas fa-circle"></i>
                                                <span class="color-name"></span>
                                            </div>
                                        </button>
                                    </div> -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                data-bs-target="#panelsStayOpen-spec" aria-expanded="true"
                                aria-controls="panelsStayOpen-spec">
                                {{儲存裝置}}
                            </button>
                        </h2>
                        <div id="panelsStayOpen-spec" class="accordion-collapse collapse show">
                            <div class="accordion-body">
                                <h5><strong>{{儲存裝置}}</strong></h5>
                                <div class="row">
                                    <div class="col-6 mb-3">
                                        <button class=" btn color-btn w-100">
                                            <div
                                                class="py-4 d-flex flex-column justify-content-center align-items-center">
                                                <p class="spec-val m-0">{{64GB}}</p>
                                                <span class="fit">$18900起</span>
                                            </div>
                                        </button>
                                    </div>
                                    <div class="col-6 mb-3">
                                        <button class=" btn color-btn w-100">
                                            <div
                                                class="py-4 d-flex flex-column justify-content-center align-items-center">
                                                <p class="spec-val m-0">{{64GB}}</p>
                                                <span class="fit">$18900起</span>
                                            </div>
                                        </button>
                                    </div>
                                    <div class="col-6 mb-3">
                                        <button class=" btn color-btn w-100">
                                            <div
                                                class="py-4 d-flex flex-column justify-content-center align-items-center">
                                                <p class="spec-val m-0">{{64GB}}</p>
                                                <span class="fit">$18900起</span>
                                            </div>
                                        </button>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div> -->
                </div>
            </div>
        </div>
    </section>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
    <script src="./appleProductArray.js"></script>
    <script>
        //DOM
        const navbar = document.querySelector('.nav-bar')
        const productType = document.querySelector('.product-type')
        const priceTop = document.querySelector('.price-top')
        const productName = document.querySelector('.product-name')
        const productImg = document.querySelector('.product-img')

        const colorAreaControlBtn = document.querySelector('[aria-controls="panelsStayOpen-color"]')
        const colorArea = document.querySelector('.color-area')

        const accordionBox = document.querySelector('.accordion')

        //window.onload
        window.onload = function () {
            showNavbar()
            selectProduct(appleList[0])

        }

        //function
        function showNavbar() {
            const productList = appleList.map(x => x.type)
            productList.forEach((item, index) => {
                const li = document.createElement('li')

                const a = document.createElement('a')
                a.innerText = item
                a.href = `#${item}`
                a.classList.add('btn', 'btn-dark', 'product')
                a.onclick = function () {
                    selectProduct(appleList[index])
                }

                li.appendChild(a)
                navbar.appendChild(li)
            })
        }

        function selectProduct(product) {
            resetApple()

            productType.innerText = product.type
            productName.innerText = `購買${product.name}`

            productImg.src = product.mainImg

            priceTop.innerText = '$0'

            // color

            product.colorList.forEach((item) => {
                const div = document.createElement('div')
                div.classList.add('col-6', 'mb-3')

                const btn = document.createElement('button')
                btn.classList.add('btn', 'color-btn', 'w-100')
                btn.setAttribute('selected', 'false')
                btn.onclick = function () {
                    colorArea.querySelectorAll('.btn').forEach(b => {
                        b.setAttribute('selected', 'false')
                    })
                    btn.setAttribute('selected', 'true')
                    productImg.src = item.img
                    colorAreaControlBtn.innerText = item.name
                    colorAreaControlBtn.click()
                }

                const btnDiv = document.createElement('div')
                btnDiv.classList.add('py-4', 'd-flex', 'flex-column', 'justify-content-center', 'align-items-center')

                const i = document.createElement('i')
                i.classList.add('fas', 'fa-circle')
                i.style.color = item.color
                const span = document.createElement('span')
                span.classList.add('color-name')
                span.innerText = item.name

                btnDiv.appendChild(i)
                btnDiv.appendChild(span)
                btn.appendChild(btnDiv)
                div.appendChild(btn)
                colorArea.appendChild(div)
            })

            //spec
            product.spec.forEach((item) => {
                const accordionItem = document.createElement('div')
                accordionItem.classList.add('accordion-item')

                const accordionTitle = document.createElement('h2')
                accordionTitle.classList.add('accordion-header')
                const accordionBtn = document.createElement('button')
                accordionBtn.innerText = `{{${item.name}}}`
                accordionBtn.classList.add('accordion-button')
                accordionBtn.setAttribute('type', 'button')
                accordionBtn.setAttribute('data-bs-toggle', 'collapse')
                accordionBtn.setAttribute('data-bs-target', `#panelsStayOpen-${item.name}`)
                accordionBtn.setAttribute('aria-expanded', 'true')
                accordionBtn.setAttribute('aria-controls', `#panelsStayOpen-${item.name}`)

                accordionTitle.appendChild(accordionBtn)

                const accordionContent = document.createElement('div')
                accordionContent.setAttribute('id', `panelsStayOpen-${item.name}`)
                accordionContent.classList.add('accordion-collapse', 'collapse', 'show')

                const accordionBody = document.createElement('div')
                accordionBody.classList.add('accordion-body')

                const h5 = document.createElement('h5')
                const strong = document.createElement('strong')
                strong.innerText = item.name

                h5.appendChild(strong)

                const specDiv = document.createElement('div')
                specDiv.classList.add('row')

                item.specDetails.forEach((specItem) => {
                    const div = document.createElement('div')
                    div.classList.add('col-6', 'mb-3')

                    const btn = document.createElement('button')
                    btn.classList.add('btn', 'color-btn', 'w-100')
                    btn.setAttribute('selected', 'false')
                    btn.setAttribute('fit', specItem.fit)
                    btn.onclick = function () {
                        specDiv.querySelectorAll('.btn').forEach(b => {
                            b.setAttribute('selected', 'false')
                        })
                        btn.setAttribute('selected', 'true')
                        specDiv.setAttribute('use-fit', specItem.fit)
                        showPrice(product)
                        accordionBtn.innerText = specItem.name
                        accordionBtn.click()
                    }

                    const btnDiv = document.createElement('div')
                    btnDiv.classList.add('py-4', 'd-flex', 'flex-column', 'justify-content-center', 'align-items-center')

                    const p = document.createElement('p')
                    p.classList.add('spec-val', 'm-0')
                    p.innerText = specItem.name
                    const span = document.createElement('span')
                    span.classList.add('fit')
                    span.innerText = `NT$${product.price + specItem.fit}起`

                    btnDiv.appendChild(p)
                    btnDiv.appendChild(span)
                    btn.appendChild(btnDiv)
                    div.appendChild(btn)
                    specDiv.appendChild(div)
                })

                accordionBody.appendChild(h5)
                accordionBody.appendChild(specDiv)

                accordionContent.appendChild(accordionBody)

                accordionItem.appendChild(accordionTitle)
                accordionItem.appendChild(accordionContent)

                accordionBox.appendChild(accordionItem)
            })
        }

        function showPrice(product) {
            const selectedFits = Array.from(document.querySelectorAll('[fit][selected="true"]'))
            const money = selectedFits.length > 0 ? selectedFits.map(x => parseInt(x.getAttributeNode('fit').value)).reduce((a, b) => a + b) : 0

            showPriceTags(money, product)

            priceTop.innerText = `$${product.price + money}`
        }

        function showPriceTags(money, product) {
            const priceTags = document.querySelectorAll('[fit]')
            priceTags.forEach(tag => {
                const fit = parseInt(tag.getAttributeNode('fit').value)
                if (tag.parentNode.parentNode.getAttributeNode('use-fit') != null) {
                    const useFit = parseInt(tag.parentNode.parentNode.getAttributeNode('use-fit').value)
                    if (fit <= useFit) {
                        tag.querySelector('span').innerText = `NT$${product.price + money + fit - useFit}起`
                    } else {
                        tag.querySelector('span').innerText = `NT$${product.price + money + fit}起`
                    }
                } else {
                    tag.querySelector('span').innerText = `NT$${product.price + money + fit}起`
                }
            })
        }

        function resetApple() {
            // colorArea.innerHTML = ''
            bootstrap.Collapse.getOrCreateInstance(document.querySelector('#panelsStayOpen-color')).show()
            const removeItem = accordionBox.querySelectorAll('.accordion-item')
            console.log(removeItem)
            if (removeItem.length > 1) {
                for (let i = 1; i < removeItem.length; i++) {
                    accordionBox.removeChild(accordionBox.children[1])
                }
            }
        }
    </script>
</body>

</html>